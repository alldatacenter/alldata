componentType: K8S_MICROSERVICE
componentName: tkgone
options:
  containers:
    - ports:
        - containerPort: 7001
      name: server
      build:
        imagePush: ${IMAGE_BUILD_ENABLE}
        imagePushRegistry: ${IMAGE_PUSH_REGISTRY}
        args:
          TAG: ack
        dockerfileTemplateArgs:
          MAVEN_IMAGE: ${MAVEN_IMAGE}
          JRE8_IMAGE: ${JRE8_IMAGE}
          MAVEN_SETTINGS_XML: ${MAVEN_SETTINGS_XML}
        dockerfileTemplate: Dockerfile.tpl
        repoPath: saas/search/api/tkg-one
        branch: ${SOURCE_BRANCH}
        repo: ${SOURCE_REPO}
        ciAccount: "${SOURCE_CI_ACCOUNT}"
        ciToken: "${SOURCE_CI_TOKEN}"


  initContainers:
    - name: db-migration
      build:
        imagePush: ${IMAGE_BUILD_ENABLE}
        imagePushRegistry: ${IMAGE_PUSH_REGISTRY}
        args:
          TAG: ack
        dockerfileTemplateArgs:
          MIGRATE_IMAGE: ${MIGRATE_IMAGE}
        dockerfileTemplate: Dockerfile_db_migration.tpl
        repoPath: saas/search/api/tkg-one
        branch: ${SOURCE_BRANCH}
        repo: ${SOURCE_REPO}
        ciAccount: "${SOURCE_CI_ACCOUNT}"
        ciToken: "${SOURCE_CI_TOKEN}"

  env:
    - CLOUD_TYPE
    - AAS_LOGIN_URL
    - BLINK_AQUILA_PORT
    - DATAHUB_DB_NAME
    - AAS_OPENAPI_URL
    - TJMON_ACCOUNT_ID
    - ZONE
    - DB_PORT
    - ABM_CLUSTER
    - BLINK_DRUID_PORT
    - AAS_POP_KEY
    - DB_PASSWORD
    - ODPS_SERVICE_ENDPOINT
    - STARAGENT_SECRET
    - ACCOUNT_SUPER_SECRET_KEY
    - DB_NAME_TIANJI
    - TJMON_ACCESSKEY_SECRET
    - ENDPOINT_PAAS_PRODUCTOPS
    - REDIS_DB
    - BLINK_BAYES_ENDPOINT
    - VIP_IP_PAAS_GRAFANA
    - ELASTICSEARCH_USER
    - CICD_PROJECTID
    - ZOOKEEPER_PORT
    - TIANJI_SUPERKEY_ID
    - ELASTICSEARCH_HOST
    - AAS_OPENAPI_DOMAIN
    - ENDPOINT_PAAS_TIANJI
    - DNS_PAAS_HOME
    - ODPS_ACCOUNT_KEY
    - ACCOUNT_BASE_PK
    - KMS_ENDPOINT
    - DATAWORKS_IDE_URL
    - COOKIE_DOMAIN
    - ENDPOINT_PAAS_DR_MUTILCLOUD
    - CLUSTER_SCALE_FLAG
    - IDC_ROOM
    - BLINK_BAYES_ADMIN_ACCESS_KEY
    - MINIO_SECRET_KEY
    - AAS_POP_SECRET
    - BLINK_BAYES_RDS_DB
    - BLINK_AQUILA_ADMIN_NAME
    - ENDPOINT_PAAS_CHANNEL
    - DB_USER
    - ODPS_CLUSTER_NAME
    - DB_NAME_AG
    - ENDPOINT_PAAS_AUTHPROXY
    - ENDPOINT_SAAS_CALIFORNIA
    - AAS_AK_KEY
    - STARAGENT_KEY
    - AAS_LOGOUT_URL
    - VIP_IP_PAAS_HOME
    - ODPS_GRIP_PORT
    - TJMON_ACCESSKEY_ID
    - REDIS_PASSWORD
    - ENDPOINT_PAAS_STARAGENT
    - TIANJI_SUPERKEY_IDSECRET
    - ACCOUNT_SUPER_ACCESS_KEY
    - ASS_CALLBACK_URL
    - TJMON_ACCOUNT_USER
    - KMS_EXISTS
    - ENDPOINT_PAAS_GATEWAY
    - AAS_ENDPOINT
    - CONTAINER_IP_LIST
    - CONTAINER_IP_LIST_TKGONE
    - ENDPOINT_SAAS_BASE_CONSOLE
    - GRAPHCOMPUTE_PORT
    - TJMON_ALERT_API
    - REGION
    - ENDPOINT_SAAS_GRAPHCOMPUTE
    - ACCOUNT_SUPER_ID
    - BLINK_DRUID_ENDPOINT
    - ENDPOINT_PAAS_FAAS_MANAGER
    - TIANJI_PORTAL_URL
    - ENDPOINT_SAAS_DATAHUB
    - ACCOUNT_BASE_ACCESS_KEY
    - DATAHUB_DB_USER
    - TIANJI_API_URL
    - ENDPOINT_PAAS_PROCESS
    - BLINK_DRUID_HOST
    - ENDPOINT_SAAS_EBLINK
    - ODPS_GRIP_ENDPOINT
    - HOLO_MANAGER_ENDPOINT
    - ELASTICSEARCH_PASSWORD
    - BLINK_SERVER_MASTER_IPS
    - AAS_INNER_ENDPOINT
    - ENDPOINT_PAAS_HOME
    - DATAWORKS_TOKEN
    - ENDPOINT_PAAS_TKGONE
    - ENDPOINT_SAAS_TESLA
    - ENDPOINT_PAAS_CMDB
    - BLINK_AQUILA_ADMIN_PASSWORD
    - ENDPOINT_GRPC_PAAS_CHECK
    - VIP_IP_PAAS_TASKPLATFORM_GRPC
    - ENDPOINT_PAAS_MINIO
    - DATAWORKS_KEY
    - ENDPOINT_SAAS_DATAWORKS
    - ENDPOINT_SAAS_ELASTICSEARCH
    - VIP_PORT_PAAS_TKGONE
    - ACCOUNT_ODPS_SECRET_KEY
    - GRAPHCOMPUTE_CLUSTER_ID
    - GRAPHCOMPUTE_ENDPOINT
    - ODPS_LOGVIEW_HOST
    - BLINK_BAYES_ADMIN_PASSWORD
    - ENDPOINT_SAAS_ODPS
    - ACCOUNT_ODPS_PK
    - REDIS_HOST
    - OSS_ACCOUNT_ACCESS_KEY
    - ENDPOINT_SAAS_STANDARD_CLUSTER
    - ENDPOINT_PAAS_CHECK
    - DATAHUB_DB_HOST
    - BLINK_BAYES_RDS_PORT
    - ODPS_CONTROLLER_IP
    - DATAWORKS_TENANT_URL
    - ACCOUNT_BASE_ACCESS_ID
    - DATAWORKS_CLUSTER
    - BLINK_BAYES_RDS_USER
    - URL_PAAS_GATEWAY
    - ENDPOINT_SAAS_BLINK
    - DATAHUB_DB_PASSWORD
    - BLINK_AQUILA_HOST
    - ACCOUNT_BASE_SECRET_KEY
    - OSS_ACCOUNT_ACCESS_ID
    - ENDPOINT_SAAS_HOLO
    - ELASTICSEARCH_PORT
    - DATAWORKS_API_DOMAIN
    - BLINK_BAYES_RDS_HOST
    - OTS_ENDPOINT
    - ENDPOINT_PAAS_TASKPLATFORM
    - REQUESTED_IP
    - BLINK_BAYES_RDS_PASSWORD
    - VM_IP_LIST
    - VIP_IP_PAAS_TKGONE
    - ENDPOINT_PAAS_GRAFANA
    - AAS_DIRECT_LOGIN_URL
    - AAS_AK_ID
    - ENDPOINT_GRPC_PAAS_TIANJI
    - TJMON_METRICS_API
    - ZOOKEEPER_HOSTS
    - BLINK_BAYES_ADMIN_NAME
    - BLINK_BAYES_ADMIN_ACCESS_ID
    - ENDPOINT_PAAS_CONNECTOR
    - ENV_TYPE
    - DNS_PAAS_HOME_DISASTER
    - NETWORK_PROTOCOL
    - DB_NAME
    - ACCOUNT_SUPER_CLIENT_SECRET
    - OSS_ENDPOINT
    - TJMON_PROJECT
    - ACCOUNT_SUPER_CLIENT_ID
    - BLINK_DRUID_TOKEN
    - ZOOKEEPER_ENDPOINT
    - ACCOUNT_ODPS_ACCESS_KEY
    - ENDPOINT_GRPC_PAAS_TASKPLATFORM
    - ODPS_ACCOUNT_ID
    - REDIS_PORT
    - DATAHUB_DB_PORT
    - ACCOUNT_SUPER_ACCESS_ID
    - MINIO_ACCESS_KEY
    - ACCOUNT_ODPS_ID
    - OSS_ACCOUNT_ACCOUNT
    - ACCOUNT_SUPER_PK
    - TJMON_SITERULE_API
    - VIP_PORT_PAAS_TASKPLATFORM_GRPC
    - URL_PAAS_HOME
    - IDC_MAP
    - ENDPOINT_SAAS_DWG
    - DB_HOST
    - TJMON_METRIC
    - ENDPOINT_PAAS_FRONTEND_SERVICE
    - ACCOUNT_ODPS_ACCESS_ID
    - ELASTICSEARCH_CONTAINER_IP_LIST
    - ACCOUNT_BASE_ID
    - CENTER_REGION
    - HOLO_MANAGER_PORT
    - NACOS_NAMESPACE
    - NACOS_ENDPOINT
    - DATA_DB_HOST
    - DATA_DB_PORT
    - DATA_DB_USER
    - DATA_DB_PASSWORD
    - DATA_ES_HOST
    - DATA_ES_PORT
    - DATA_ES_USER
    - DATA_ES_PASSWORD 
